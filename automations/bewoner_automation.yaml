# AUTOMATIONS BASED ON LOCATION OF BEWONER

- alias: Notify - Bewoner - Thuis of Weg
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id:
      - person.caroline
      - person.bert
    to: home
  - platform: state
    entity_id:
      - person.caroline
      - person.bert
    to: not_home
    from: home
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' %}
          script.notify_tracker_caro_thuis
        {% elif trigger.from_state.entity_id == 'person.bert' %}
          script.notify_tracker_bert_thuis
        {% endif %}

- alias: Notify - Bewoner - Thuis of Weg 2
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id:
      - person.caroline
    to: home
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' %}
          script.notify_tracker_caro_thuis_ios_bert
        {% endif %}

- alias: Notify - Bewoner - Thuis - Babysit
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id:
      - person.caroline
      - person.bert
    to: home
    from: not_home
  condition:
  - condition: state
    entity_id: input_boolean.visitor
    state: 'on'
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' %}
          script.notify_bezoeker_babysit_ios_caro
        {% elif trigger.from_state.entity_id == 'person.bert' %}
          script.notify_bezoeker_babysit_ios_bert
        {% endif %}

- alias: Notify - Bewoner - Aan Opvang
  trigger:
  - platform: template
    value_template: "{{ states('person.caroline') in ['Ivy', 'Nancy', 'Mama & Mark'] }}"
  - platform: template
    value_template: "{{ states('person.bert') in ['Ivy', 'Nancy', 'Mama & Mark'] }}"
  condition:
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' %}
          script.notify_tracker_caro_zones
        {% elif trigger.from_state.entity_id == 'person.bert' %}
          script.notify_tracker_bert_zones
        {% endif %}

- alias: Notify - Bewoner - Aan Checkpoint
  trigger:
  - platform: template
    value_template: "{{ states('person.caroline') in ['Checkpoint 1', 'Checkpoint 2', 'Checkpoint 3', 'Checkpoint 4', 'Checkpoint 5'] }}"
  - platform: template
    value_template: "{{ states('person.bert') in ['Mechelen Station', 'Willebroek Station', 'Checkpoint 3'] }}"
  condition:
  - condition: time
    after: !secret work_week_mid
    before: !secret sleep_week
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' %}
          script.notify_tracker_caro_zones
        {% elif trigger.from_state.entity_id == 'person.bert' %}
          script.notify_tracker_bert_zones
        {% endif %}

- alias: Notify - Bewoner - Aan Ziekenhuis
  trigger:
  - platform: template
    value_template: "{{ states('person.caroline') in ['Ziekenhuis St-Augustinus', 'Ziekenhuis Willebroek', 'Ziekenhuis Edegem', 'Ziekenhuis Reet', 'Ziekenhuis Middelheim'] }}"
  - platform: template
    value_template: "{{ states('person.bert') in ['Ziekenhuis St-Augustinus', 'Ziekenhuis Willebroek', 'Ziekenhuis Edegem', 'Ziekenhuis Reet', 'Ziekenhuis Middelheim'] }}"
  action:
  - delay: 00:02:00
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if trigger.from_state.entity_id == 'person.caroline' and states('person.bert') not in ['Ziekenhuis St-Augustinus', 'Ziekenhuis Willebroek', 'Ziekenhuis Edegem', 'Ziekenhuis Reet', 'Ziekenhuis Middelheim'] %}
          script.notify_tracker_caro_zones
        {% elif trigger.from_state.entity_id == 'person.bert' and states('person.caroline') not in ['Ziekenhuis St-Augustinus', 'Ziekenhuis Willebroek', 'Ziekenhuis Edegem', 'Ziekenhuis Reet', 'Ziekenhuis Middelheim'] %}
          script.notify_tracker_bert_zones
        {% endif %}

# AUTOMATIONS BASED ON LOCATION OF BERT - NMBS STATIONS

- alias: Notify - Bewoner - Bert - Aan Willebroek Station
  trigger:
  - entity_id: person.bert
    platform: state
    to: Willebroek Station
  condition:
  - condition: time
    before: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_willebroek_mechelen_ios_bert

- alias: Notify - Bewoner - Bert - Aan Mechelen Station
  trigger:
  - entity_id: person.bert
    platform: state
    to: Mechelen Station
  condition:
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if (states('sensor.time') <= "13:00") %}
          script.notify_nmbs_mechelen_brussel_ios_bert
        {% else %}
          script.notify_nmbs_mechelen_willebroek_ios_bert
        {% endif %}

- alias: Notify - Bewoner - Bert - Aan Brussel Station
  trigger:
  - entity_id: person.bert
    platform: state
    to: Brussel Station
  condition:
  - condition: time
    after: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_brussel_mechelen_ios_bert

- alias: Notify - Bewoner - Bert - Aan Willebroek Station Change
  trigger:
  - entity_id: sensor.nmbs_template
    platform: state
  condition:
  - condition: state
    entity_id: person.bert
    state: Willebroek Station
  - condition: time
    before: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_willebroek_mechelen_ios_bert

- alias: Notify - Bewoner - Bert - Aan Mechelen Station Change Wil
  trigger:
  - entity_id: sensor.nmbs_3_template
    platform: state
  condition:
  - condition: state
    entity_id: person.bert
    state: Mechelen Station
  - condition: time
    after: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_mechelen_willebroek_ios_bert

- alias: Notify - Bewoner - Bert - Aan Mechelen Station Change Brus
  trigger:
  - entity_id: sensor.nmbs_2_template
    platform: state
  condition:
  - condition: state
    entity_id: person.bert
    state: Mechelen Station
  - condition: time
    before: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_mechelen_brussel_ios_bert

- alias: Notify - Bewoner - Bert - Aan Brussel Station Change
  trigger:
  - entity_id: sensor.nmbs_4_template
    platform: state
  condition:
  - condition: state
    entity_id: person.bert
    state: Brussel Station
  - condition: time
    after: !secret work_week_mid
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id: script.notify_nmbs_brussel_mechelen_ios_bert
