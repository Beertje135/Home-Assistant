# AUTOMATIONS TO CHANGE HEATING

# BASED ON WONING STATUS

- alias: Verwarming - Woning Weg - Eco Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Weg'
    for:
      minutes: 5
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: state
    entity_id: input_select.woning_status
    state: 'Weg'
  - condition: or
    conditions:
      #Away during day in the weekend
    - condition: time
      after: !secret awake_weekend_heating
      before: !secret sleep_weekend
      weekday:
        - sat
        - sun
      #Away early before work in the week
    - condition: time
      after: !secret awake_week_heating
      before: !secret work_week_start
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      #Away late after work in the week
    - condition: time
      after: !secret work_week_end_heating
      before: !secret sleep_week
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_economy

- alias: Verwarming - Woning Weg - Auto Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Weg'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: or
    conditions:
      #Away during night in the weekend
    - condition: time
      after: !secret sleep_weekend
      before: !secret awake_weekend_heating
      weekday:
        - sat
        - sun
      #Away during work in the week
    - condition: time
      after: !secret work_week_start
      before: !secret work_week_end_heating
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      #Away during night in the week
    - condition: time
      after: !secret sleep_week
      before: !secret awake_week_heating
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Woning Thuis - Auto Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Thuis'
    for:
      minutes: 1
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: or
    conditions:
      - condition: template
        value_template: "{{ states.climate.ons_huisje.attributes.preset_mode != None }}"
      - condition: template
        value_template: "{{ states.climate.badkamer.attributes.preset_mode != 'none' or states.climate.slp_kamer.attributes.preset_mode != 'none' or states.climate.dressing.attributes.preset_mode != 'none' or states.climate.keuken.attributes.preset_mode != 'none' or states.climate.woonkamer.attributes.preset_mode != 'none' or states.climate.kamer_elmo.attributes.preset_mode != 'none' }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Woning Thuis (Werk) - Custom Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Thuis (Werk)'
    for:
      minutes: 1
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_custom

- alias: Verwarming - Woning Juist Wakker Week - Rise (Keuken)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Juist Wakker'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Awake early before heating on
  - condition: time
    before: !secret awake_week_heating
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_kitchen_rise

- alias: Verwarming - Woning Juist Wakker Weekend - Rise (Beneden)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Juist Wakker'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Awake early before heating on
  - condition: time
    before: !secret awake_weekend_heating
    weekday:
      - sat
      - sun
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_living_room_rise
      - script.evo_zone_kitchen_rise

- alias: Verwarming - Woning Slapen Week - Lower (Beneden)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Sleep early before heating off
  - condition: time
    after: !secret awake_week_heating
    before: !secret sleep_week
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    #Only when not verlof 
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_kitchen_lower
      - script.evo_zone_living_room_lower

- alias: Verwarming - Woning Slapen Weekend - Lower (Beneden)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Sleep early before heating off
  - condition: time
    after: !secret awake_weekend_heating
    before: !secret sleep_weekend
    weekday:
      - sat
      - sun
    #Only when not verlof 
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_kitchen_lower
      - script.evo_zone_living_room_lower

- alias: Verwarming - Woning Slapen Week - Auto Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Sleep early before heating off week or weekend
  - condition: time
    before: !secret awake_week_heating
    after: !secret sleep_week
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    #Only when not verlof 
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off' 
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Woning Slapen Weekend - Auto Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: time
    before: !secret awake_weekend_heating
    after: !secret sleep_weekend
    weekday:
      - sat
      - sun
    #Only when not verlof 
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off' 
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Woning Vakantie - Off
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Op Vakantie'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_heating_off

# DURING HOLIDAY AT HOME

- alias: Verwarming - Woning Juist Wakker Verlof - Rise (Beneden)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Juist Wakker'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
    #Awake early before heating on
  - condition: time
    before: !secret awake_weekend_heating
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_living_room_rise
      - script.evo_zone_kitchen_rise

- alias: Verwarming - Woning Thuis (Verlof) - Day Off Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Thuis (Verlof)'
    for:
      minutes: 1
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_day_off

- alias: Verwarming - Woning Slapen Verlof - Lower (Beneden)
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Sleep early before heating off
  - condition: time
    after: !secret awake_weekend_heating
    before: !secret sleep_weekend
    #Only when verlof 
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_kitchen_lower
      - script.evo_zone_living_room_lower

- alias: Verwarming - Woning Slapen Verlof - Day Off Mode
  trigger:
  - entity_id: input_select.woning_status
    platform: state
    to: 'Slapen'
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Sleep early before heating off verlof
  - condition: time
    before: !secret awake_weekend_heating
    after: !secret sleep_weekend
    #Only when not verlof
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_day_off

# BASED ON TIME OF DAY

- alias: Verwarming - Time week - Start Work - Auto Mode
  trigger:
  - platform: time
    at: !secret work_week_start
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: state
    entity_id: group.bewoners
    state: 'not_home'
  - condition: state
    entity_id: group.bezoekers
    state: 'not_home'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Only on weekdays
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  - condition: or
    conditions:
      #Only if kitchen has overwrite
    - condition: template
      value_template: "{{ (states.climate.keuken.attributes.preset_mode == 'permanent') or (states.climate.keuken.attributes.preset_mode == 'temporary') }}"
      #Only if livingroom has overwrite
    - condition: template
      value_template: "{{ (states.climate.woonkamer.attributes.preset_mode == 'permanent') or (states.climate.woonkamer.attributes.preset_mode == 'temporary') }}"
      #Only if quick action is set to Eco
    - condition: template
      value_template: "{{ states.climate.ons_huisje.preset_mode == eco }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Time week - End Work - Eco Mode
  trigger:
  - platform: time
    at: !secret work_week_end
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Only when not home
  - condition: state
    entity_id: input_select.woning_status
    state: 'Weg'
  - condition: state
    entity_id: group.bewoners
    state: 'not_home'
  - condition: state
    entity_id: group.bezoekers
    state: 'not_home'
    #Only on weekdays
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_economy

- alias: Verwarming - Time week - Awake Evening - Rise (Woonkamer)
  trigger:
  - platform: time
    at: !secret sleep_week
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Only on weekdays
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    #Only if we are home and not asleep
  - condition: state
    entity_id: input_select.woning_status
    state: 'Thuis'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_living_room_rise

- alias: Verwarming - Time week - Slapen - Auto Mode
  trigger:
  - platform: time
    at: !secret sleep_week
  condition:
  - condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
  - condition: state
    entity_id: input_select.woning_status
    state: 'Slapen'
  - condition: or
    conditions:
    - condition: template
      value_template: "{{ states.climate.keuken.attributes.preset_mode == 'permanent' }}"
    - condition: template
      value_template: "{{ states.climate.woonkamer.attributes.preset_mode == 'permanent' }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Time weekend - Morning - Auto Mode
  trigger:
  - platform: time
    at: !secret awake_weekend
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
    #Only during weekends
  - condition: time
    weekday:
      - sat
      - sun
  - condition: or
    conditions:
      #Only if kitchen has overwrite
    - condition: template
      value_template: "{{ (states.climate.keuken.attributes.preset_mode == 'permanent') or (states.climate.keuken.attributes.preset_mode == 'temporary') }}"
      #Only if livingroom has overwrite
    - condition: template
      value_template: "{{ (states.climate.woonkamer.attributes.preset_mode == 'permanent') or (states.climate.woonkamer.attributes.preset_mode == 'temporary') }}"
      #Only if quick action is set to Eco
    - condition: template
      value_template: "{{ states.climate.ons_huisje.preset_mode == eco }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Time weekend - Awake Evening - Rise (Woonkamer)
  trigger:
  - platform: time
    at: !secret sleep_weekend
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'       
    #Only during weekends
  - condition: time
    weekday:
      - sat
      - sun
    #Only if we are home and not asleep
  - condition: state
    entity_id: input_select.woning_status
    state: 'Thuis'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_living_room_rise

- alias: Verwarming - Time weekend - Slapen - Auto Mode
  trigger:
  - platform: time
    at: !secret sleep_weekend
  condition:
  - condition: time
    weekday:
      - sat
      - sun
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'    
  - condition: state
    entity_id: input_select.woning_status
    state: 'Slapen'
  - condition: or
    conditions:
      #Only if kitchen has overwrite
    - condition: template
      value_template: "{{ (states.climate.keuken.attributes.preset_mode == 'permanent') or (states.climate.keuken.attributes.preset_mode == 'temporary') }}"
      #Only if livingroom has overwrite
    - condition: template
      value_template: "{{ (states.climate.woonkamer.attributes.preset_mode == 'permanent') or (states.climate.woonkamer.attributes.preset_mode == 'temporary') }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_normal

- alias: Verwarming - Time verlof - Morning - Day Off Mode
  trigger:
  - platform: time
    at: !secret awake_weekend
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
  - condition: or
    conditions:
      #Only if kitchen has overwrite
    - condition: template
      value_template: "{{ (states.climate.keuken.attributes.preset_mode == 'permanent') or (states.climate.keuken.attributes.preset_mode == 'temporary') }}"
      #Only if livingroom has overwrite
    - condition: template
      value_template: "{{ (states.climate.woonkamer.attributes.preset_mode == 'permanent') or (states.climate.woonkamer.attributes.preset_mode == 'temporary') }}"
      #Only if quick action is set to Eco
    - condition: template
      value_template: "{{ states.climate.ons_huisje.preset_mode == eco }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_day_off

- alias: Verwarming - Time verlof - Awake Evening - Rise (Woonkamer)
  trigger:
  - platform: time
    at: !secret sleep_weekend
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
    #Only if we are home and not asleep
  - condition: state
    entity_id: input_select.woning_status
    state: 'Thuis (Verlof)'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_living_room_rise

- alias: Verwarming - Time verlof - Slapen - Day Off Mode
  trigger:
  - platform: time
    at: !secret sleep_weekend
  condition:
    #Only when verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'on'
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  - condition: state
    entity_id: input_select.woning_status
    state: 'Slapen'
  - condition: or
    conditions:
      #Only if kitchen has overwrite
    - condition: template
      value_template: "{{ (states.climate.keuken.attributes.preset_mode == 'permanent') or (states.climate.keuken.attributes.preset_mode == 'temporary') }}"
      #Only if livingroom has overwrite
    - condition: template
      value_template: "{{ (states.climate.woonkamer.attributes.preset_mode == 'permanent') or (states.climate.woonkamer.attributes.preset_mode == 'temporary') }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_day_off

- alias: Verwarming - Timer Overwrite - Badkamer - Auto Mode
  trigger:
  - platform: state
    entity_id: climate.badkamer
    to: 'Permanent'
    for:
      minutes: 180
  - platform: state
    entity_id: climate.badkamer
    to: 'Temporary'
    for:
      minutes: 180
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_zone_bathroom_reset

# BASED ON LOCATION

- alias: Verwarming - Location week - Going Home - Custom Mode
  trigger:
  - entity_id: person.bert
    platform: state
    to: Willebroek Station
  - entity_id: person.caroline
    platform: state
    to: Checkpoint 1
  - entity_id: person.caroline
    platform: state
    to: Checkpoint 3
  - entity_id: person.caroline
    platform: state
    to: Checkpoint 4
  - entity_id: person.caroline
    platform: state
    to: Checkpoint 5
  condition:
    #Boolean to indicate heating on/off
  - condition: state
    entity_id: input_boolean.heating
    state: 'on'
    #Only when not verlof  
  - condition: state
    entity_id: calendar.verlof_agenda
    state: 'off'
  - condition: or
    conditions:
    - condition: time
      after: !secret work_week_mid
      before: !secret work_week_end_heating
      weekday:
        - mon
        - tue
        - thu
        - fri
  action:
  - service: script.turn_on
    entity_id:
      - script.evo_status_custom

# AUTOMATIONS BASED ON WINDOW OPEN ELMO's ROOM

- alias: Verwarming - Window Open - Kamer Elmo Koud
  trigger:
  - platform: template
    value_template: "{{ state_attr('climate.slp_kamer', 'current_temperature') < 15.1 }}"
  - platform: template
    value_template: "{{ state_attr('climate.kamer_elmo', 'current_temperature') < 15.1 }}"
  condition:
  - condition: template
    value_template: "{{ states('input_select.woning_status') in ['Thuis', 'Thuis (Werk)', 'Thuis (Verlof)'] }}"
  action:
  - service: script.turn_on
    entity_id:
      - script.notify_heating_cold_elmo

# BOOLEAN INPUT_HEATING - IS USED TO TEMPORARY DISBALE THE HEATING AUTOMATIONS
# NEED TO SPECIFY IN YOUR AUTOMATIONS CONDITION INPUT_HEATING IS ON

- alias: Verwarming - Boolean Change based on Outside Temperature
  trigger:
  - platform: template
    value_template: "{{ state_attr('weather.dark_sky', 'temperature') < 21.0 }}"
  - platform: template
    value_template: "{{ state_attr('weather.dark_sky', 'temperature') > 21.5 }}"
  condition:
  - condition: template
    value_template: "{{ not is_state('sensor.season', 'summer') }}"
  action:
    service_template: >
      {% if state_attr('weather.dark_sky', 'temperature') < 21.0 -%}
        input_boolean.turn_on
      {%- elif state_attr('weather.dark_sky', 'temperature') > 21.5 -%}
        input_boolean.turn_off
      {%- endif %}
    data:
      entity_id:
        - input_boolean.heating

# BOOLEAN INPUT_HEATING - WHEN SUMMER THE AUTOMATIONS FOR THE HEATING NEED TO BE DISABLED

- alias: Verwarming - Boolean Change based on Season
  trigger:
  - entity_id: sensor.season
    platform: state
  action:
    service_template: >
      {%- if is_state('sensor.season', 'summer') -%}
        input_boolean.turn_off
      {%- else -%}
        input_boolean.turn_on
      {%- endif %}
    data:
      entity_id:
        - input_boolean.heating

# BASED ON BOOLEAN

- alias: Verwarming - Boolean Changes
  trigger:
  - entity_id: input_boolean.heating
    platform: state
  action:
  - service: script.turn_on
    data_template:
      entity_id: >
        {% if states('input_boolean.heating') == 'on' %}
          script.evo_status_normal_reset,
          script.notify_heating_hot_cold_outside
        {% else %}
          script.evo_status_heating_off,
          script.notify_heating_hot_cold_outside
        {% endif %}
