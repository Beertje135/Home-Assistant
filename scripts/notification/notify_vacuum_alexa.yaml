
alias: Notify Alexa - Dennis - Status
sequence:
  - condition: template
    value_template: "{{ states('group.bewoners') in ['home'] or states('group.bezoekers') in ['home']}}"
  - condition: template
    value_template: "{{ states('input_select.woning_status') not in ['Slapen'] }}"
  - wait_template: "{{ is_state('group.bewoners_router', 'home') }}"
    timeout: '00:05:00'
    continue_on_timeout: false
  - delay: 00:00:10
  - service: notify.alexa_media
    data_template:
      target:
        - media_player.alexa_kitchen_2
        - media_player.alexa_bathroom
        - media_player.alexa_livingroom_2
      message: >
        {% if state_attr('vacuum.dennis', 'status') == 'Stuck' %}
          'Dennis is stuck. Stupid Dennis'
        {% elif state_attr('vacuum.dennis', 'bin_full') == true %}
          'Dennis has eaten to much. Please empty his belly.'
        {% elif states('vacuum.dennis') in ['docked'] and states('input_boolean.vacuum_cleaned_today') in ['on'] %}
          'Dennis has completed his task.'
        {% elif states('vacuum.dennis') in ['docked'] and states('input_boolean.vacuum_cleaned_today') in ['off'] %}
          'Dennis still hasn't completed his task today'
        {% elif states('vacuum.dennis') in ['cleaning'] %}
          'Dennis starts cleaning the house. Beep Beep'
        {% else %}
          'Dennis is still going strong'
        {% endif %}
      data:
        type: announce
        method: speak