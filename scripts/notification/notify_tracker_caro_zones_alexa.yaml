
alias: Notify Alexa - Bewoner Caro - Als in zone
sequence:
  - condition: template
    value_template: "{{ states('input_boolean.notify_bert') in ['on'] }}"
  - condition: template
    value_template: "{{ states('group.bewoners_router') in ['home'] }}"
  - condition: template
    value_template: "{{ states('person.caroline') not in ['home'] }}"
  - condition: template
    value_template: "{{ states('input_select.woning_status') not in ['Slapen'] }}"
  - wait_template: "{{ states('device_tracker.router_iphone_bert') == 'home' and state_attr('device_tracker.router_iphone_bert', 'ap_mac') == 'f0:9f:c2:d6:9e:72' }}"
    timeout: '00:07:00'
    continue_on_timeout: false
  - service: notify.alexa_media
    data_template:
      target:
        - media_player.alexa_kitchen_2
        - media_player.alexa_bathroom
        - media_player.alexa_livingroom_2
      message: >
        {% if states('person.caroline') in ['Ivy', 'Nona & Pepe', 'Mimi & Fleri'] %}
          'Caroline just arrived at {{ states('person.caroline') }}.
        {% elif states('person.caroline') in ['Ziekenhuis St-Augustinus', 'Ziekenhuis Willebroek', 'Ziekenhuis Edegem', 'Ziekenhuis Reet', 'Ziekenhuis Middelheim'] %}
          'No panic but Caroline is near {{ states('person.caroline') }}.
        {% elif states('person.caroline') in ['Checkpoint 1', 'Checkpoint 4'] %}
          'Caroline is on her way home from work.'
        {% elif states('person.caroline') in ['Checkpoint 2', 'Checkpoint 3', 'Checkpoint 5'] %}
          'Caroline is almost home.'
        {% else %}
          'Where is Caroline'
        {% endif %}
      data:
        type: announce
        method: speak